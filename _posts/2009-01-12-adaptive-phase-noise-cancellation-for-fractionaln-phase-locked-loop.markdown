---

title: Adaptive phase noise cancellation for fractional-N phase locked loop
abstract: An embodiment of the invention is a circuit for adaptive phase noise cancellation for a fractional-N PLL. A preferred embodiment employs a split loop filter architecture. Two loop filter halves separately drive half-sized parallel varactors in a voltage controlled oscillator (VCO) and also drive a differential-input lowpass frequency selective circuit, e.g., a differential-input integrator in a least mean squared (LMS) feedback loop. The output of the differential-input lowpass frequency selective circuit controls the gain matching of a phase noise cancellation path to minimize phase noise arising from quantization error associated with the sequence of divider modulus values in the fractional-N PLL. The two varactor capacitances add together in the VCO tank, so the VCO frequency depends on the common-mode loop filter voltage and is relatively insensitive to differential-mode voltage. In contrast, the differential integrator operates on the differential-mode voltage from the two loop filter halves but attenuates their common-mode voltage.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07999622&OS=07999622&RS=07999622
owner: The Regents of the University of California
number: 07999622
owner_city: Oakland
owner_country: US
publication_date: 20090112
---
This application claims priority under 35 U.S.C. 119 from prior provisional application Ser. No. 61 010 640 filed Jan. 10 2008.

This invention was made with government support under Award 0515286 awarded by National Science Foundation. The government has certain rights in the invention.

A field of the invention is fractional N phased locked loops PLLs . An example application of the invention is to wireless communication circuits such as GSM and Bluetooth circuits.

If y n could be set directly to the desired fractional value then the output frequency of the PLL would settle to N f. Unfortunately y n is is restricted to integer values because the divider is only able to count integer VCO cycles. To circumvent this limitation the modulator generates a sequence of integer values that average to . The sequence can be written as y n a e n where e n is zero mean quantization noise. Thus the PLL output frequency settles to N fas desired although a price is paid in terms of added phase noise resulting from the quantization noise.

As shown in M. H. Perrott M. D. Trott C. G. Sodini A Modeling Approach for D S Fractional N Frequency Synthesizers Allowing Straightforward Noise Analysis . Vol. 37 No. 8 pp. 1028 38 August 2002 in terms of its effect on the PLL phase noise the quantization noise can be modeled as a sequence of additive charge samples Q n that get injected into the loop filter once every reference period. Neglecting a constant offset associated with the initial conditions of the loop filter it can be shown that Q n is given by

The modulator quantizes its input in such a way that e n is spectrally shaped with most of its power concentrated at high frequencies. For example in a properly dithered second order modulator e n has a power spectral density PSD equal to that of discrete time white noise with variance 1 12 passed through a high pass filter. In the example embodiment that uses a 2order delta sigma modulator the high pass filter has a transfer function 1 z . It follows from 1 that this causes Q n to have a PSD equal to that of discrete time white noise with variance TI 12 passed through a highpass filter with transfer function 1 z. Hence the PSD of Q n has a zero at DC and rises at 6 dB per octave in frequency until nearly half the reference frequency. Provided the bandwidth of the PLL is very narrow most of the power in Q n is suppressed by the PLL so it has only a small effect on the overall PLL phase noise. However as the PLL bandwidth is increased less of the power in Q n is suppressed by the PLL so its contribution to the PLL phase noise becomes more dominant. Thus there is a fundamental bandwidth versus phase noise tradeoff in conventional fractional N PLLs.

Phase noise cancelling fractional N PLLs attempt to circumvent this tradeoff by cancelling the quantization noise prior to the loop filter thereby eliminating the need for narrow band filtering by the PLL to suppress the quantization noise. shows an example wherein the idea is to add a phase noise cancellation path to a conventional fractional N PLL. The phase noise cancellation path discrete time integrates the quantization noise to obtain the digital sequence

In practice the gain of the DAC is never perfectly matched to that of the signal path through the PFD and charge pump so the cancellation of quantization noise is imperfect. Component mismatches and non ideal circuit behavior cause both amplitude and transient mismatches between the signals generated by the DAC and the charge pump . This can be modeled by considering the actual amount of charge in each DAC pulse to deviate from its ideal value of e n TIby a factor of 1 where is a small constant that represents the cancellation path mismatch. As shown in S. Pamarti I. Galton Phase noise Cancellation Design Tradeoffs in Delta Sigma Fractional N PLLs Vol. 50. No. 11 pp. 829 838 November 2003 the PSD of the component of the PLL phase noise resulting from imperfect cancellation of the quantization noise is given approximately by

In addition to the gain mismatch problem described above another type of mismatch between the charge pump and DAC occurs in practice. Specifically the charge pump pulses have a fixed amplitude and variable widths whereas the DAC pulses have a fixed width and variable amplitudes. Unfortunately this discrepancy is dictated by circuit limitations as of the time of the invention it has not been practical to generate the timing signals needed to implement width modulated DAC pulses that have sufficient accuracy. The result of the discrepancy is illustrated in for the ideal matching case of 0. The component of v t corresponding to quantization noise indeed goes to zero between DAC and charge pump pulses but the cancellation is imperfect during the DAC and charge pump pulses. Thus even if is made negligibly small the quantization noise cancellation is imperfect in practice. Fortunately the resulting phase noise is typically very small provided Tis relatively small and the DAC pulses are timed so as to overlap the charge pump pulses as much as possible. Alternatively a sampled loop filter configuration can be used to address the problem as described in S. E. Meninger and M. H. Perrott A 1 MHz Bandwidth 3.6 GHz 0.18 m CMOS fractional N Synthesizer Utilizing a Hybrid PFD DAC Structure for Reduced Broadband Phase Noise Vol. 41. No. 4 pp. 966 980 April 2006.

As described above phase noise cancellation makes it possible to greatly widen the loop bandwidth of a delta sigma fractional N PLL without the massive increase in phase noise that would otherwise be caused by the delta sigma quantization noise. This allows the loop filter to be integrated on chip reduces sensitivity to VCO pulling and noise better attenuates in band VCO noise and makes direct digital frequency modulation practical in wireless applications such as GSM and Bluetooth. However good phase noise cancellation requires good matching of the cancellation and signal paths and the matching precision required for a given level of performance increases dramatically as the reference frequency is decreased.

Example PLLs with phase noise cancellation based on passive matching have required reference frequencies of 35 MHz 48 MHz and 50 MHz to achieve 15 dB 20 dB and 29 dB of phase noise cancellation respectively. See E. Temporiti G. Albasini I. Bietti R. Castello M. Colombom A 700 kHz Bandwidth Fractional Synthesizer with Spurs Compensation and Linearization Techniques for WCDMA Applications IEEE Journal of Solid State Circuits vol. 39 no. 9 pp. 1446 54 September 2004 S. Pamarti L. Jansson 1. Galton A Wideband 2.4 GHz A Fractional N PLL with 1 Mb s In loop Modulation IEEE Journal of Solid State Circuits vol. 39 no. 1 pp. 49 62 January 2004 S. E. Meninger and M. H. Perrott and A 1 MHz Bandwidth 3.6 GHz 0.18 um CMOS Fractional N Synthesizer Utilizing a Hybrid PFD DAC Structure for Reduced Broadband Phase Noise IEEE Journal of Solid State Circuits vol. 41 no. 4 pp. 966 980 2006 . The need for such high reference frequencies represents a major limitation of phase noise cancellation with passive matching in wireless applications.

In principle the sign error LMS algorithm can be used to adaptively adjust the DAC gain to minimize . See e.g. Ali H. Saved Wiley Interscience 2003. Whenever the DAC gain is not ideal imperfect cancellation of the quantization noise causes the charge pump and DAC pulses to inject an undesired net charge of Q n TIe n into the loop filter each reference period. Suppose that a copy of these current pulses were multiplied by the sign of e n i.e. by

In practice however creating sufficiently accurate copies of the DAC and charge pump pulses multiplied by e n is challenging. This problem is circumvented in M. Gupta and B. S. Song A 1.8 GHz Spur Cancelled Fractional N Frequency Synthesizer with LMS Based DAC Gain Calibration Vol. 41 No. 12 pp. 2842 851 December 2006 by simply multiplying a buffered copy of v t by sgne n as depicted in . It can be shown that the resulting system implements an approximate version of the sign error LMS algorithm described above. Although the feedback loop can be made to work properly a practical problem arises because of the DC component in v t . The DC component is necessary because it sets the frequency of the VCO and the range of values it can take on as a function of the desired output frequency tends to be large. The problem is that the DC component gets multiplied by sgne n and then fed back through an integrator to control the DAC gain. If the feedback loop bandwidth is not sufficiently small the resulting modulation of the DAC gain severely degrades the phase noise performance of the PLL. Unfortunately as demonstrated via simulation results shown in the PSD of sgne n tends to have large spurious tones. See S. Pamarti L. Jansson I. Galton A Wideband 2.4 GHz Fractional N PLL with 1 Mb s in loop Modulation . Vol. 39 No. 1 pp. 49 62 January 2004 and K. Wang A. Swaminathan I. Galton Spurious tone suppression techniques applied to a wide bandwidth 2.4 GHz Fractional N PLL IEEE Journal of Solid State Circuits vol. 43 no 12 December 2008. The tones arise from the strong non linearity imposed by the sgn function even when the modulator s quantization noise is free of spurious tones. The tone frequencies are multiples of f so they decrease with the fractional frequency value . Therefore the LMS feedback loop bandwidth must be made very small to sufficiently attenuate the tones and this results in very slow adaptive calibration settling. For example the settling time has been reported in M. Gupta and B. S. Song A 1.8 GHz Spur Cancelled Fractional N Frequency Synthesizer with LMS based DAC Gain Calibration. . Vol. 41 No. 12 pp. 2842 851 December 2006 to be approximately 1 second.

An embodiment of the invention is a circuit for adaptive phase noise cancellation for a fractional N PLL. A preferred embodiment employs a split loop filter architecture. Two loop filter halves separately drive half sized parallel varactors in a VCO and also drive a differential input lowpass frequency selective circuit e.g. a differential integrator in a least mean squared LMS feedback loop. The two varactor capacitances add together in the VCO tank so the VCO frequency depends on the common mode loop filter voltage and is relatively insensitive to differential mode voltage. In contrast the differential input lowpass frequency selective circuit operates on the differential mode voltage from the two loop filter halves but attenuates their common mode voltage.

The invention provides a circuit and method for adaptive phase noise cancellation for a fractional N PLL. It makes it possible to achieve accurate phase noise cancellation even with low reference frequencies.

An embodiment of the invention is a circuit for adaptive phase noise cancellation for a fractional N PLL. A preferred embodiment employs a split loop filter architecture. Two loop filter halves separately drive half sized parallel varactors in a VCO and also drive a differential input lowpass frequency selective circuit. e.g. a differential input integrator in a least mean squared LMS feedback loop. The output of the differential input lowpass frequency selective circuit adjusts the gain of the DAC in the phase noise cancellation path to minimize .

The two varactor capacitances add together in the VCO tank so the VCO frequency depends on the common mode loop filter voltage and is relatively insensitive to differential mode voltage. In contrast the differential input lowpass frequency selective circuit operates on the differential mode voltage from the two loop filter halves but attenuates their common mode voltage. In preferred embodiments the output signals from the charge pump and DAC are directed to the top or bottom loop filter half according to the sign of the running sum of the to quantization noise introduced by a delta sigma modulator quantizer in the fractional N PILL.

Embodiments of the present invention give improvement to wide bandwidth fractional N PLLs for use in wireless communications applications. Circuits of preferred embodiments can yield lower power consumption greater is design flexibility and enable on chip passive loop filter halves thus saving pin count.

An experimental integrated circuit IC that implements an embodiment of the invention was fabricated and measurements from it indicate that its adaptive calibration causes it to achieve 33 dB of phase noise cancellation in a PLL with a settling time of 35 s despite its low reference frequency of 12 MHz. Methods of the invention are capable of providing better performance than the experimental fabrication as the experimental fabrication reached a noise floor set by other circuit components. Current state of the art in PLLs with passive matching phase noise cancellation have required reference frequencies of 35 MHz 48 MHz and 50 MHz to achieve 15 dB 20 dB and 29 dB of phase noise cancellation respectively as discussed in the background. The experimental IC that implements an embodiment of the invention but does not achieve the full phase noise cancellation made possible by the invention still is believed to provide a new standard with the 33 dB of noise cancellation with a reference frequency of only 12 MHz an achievement that is not believed to have been achieved previously for this class of circuits.

Preferred embodiments of the invention are discussed below with respect to the drawings. The drawings include schematic representations which will be understood by artisans in view of the general knowledge in the art and the description that follows.

The core of the adaptive calibration of the invention is shown in . Two loop filter halves separately drive half sized parallel varactors in the VCO and also drive a differential integrator which serves as a differential input lowpass frequency selective circuit in the LMS feedback loop. The two varactor capacitances add together in the VCO tank so the VCO frequency depends on the common mode loop filter voltage and is relatively insensitive to differential mode voltage. In contrast the differential integrator operates on the differential mode voltage from the two loop filter halves but attenuates their common mode voltage. Since the differential mode voltage is DC free the problem mentioned with respect to the prior art adaptive calibration technique above is avoided. Multiplication by sgne n is achieved by steering the DAC and charge pump current to the top loop filter whenever sgne n 1 and to the bottom loop filter whenever sgne n 1 via switch which thereby controls gain matching of the phase noise cancellation path defined by the LMS feedback loop. The path defined by presents an alternative where the gain of charge pump is controlled instead of the gain of the current DAC . In either case as seen in the dynamics of the LMS calibration loop are determined by a differential mode half circuit and those of the PLL are determined by common mode half circuit .

The operation of the LMS calibration loop can be seen from the differential mode half circuit in . The current steering operation effectively multiplies the charge pump and DAC pulses each reference period by sgne n . The two pulses are then filtered and integrated as shown in the figure to generate a current I which is used to adjust the bias current and therefore the gain of the DAC. Since the charge pump and DAC pulses are multiplied by sgne n prior to filtering the system implements the true sign error LMS algorithm described above. By avoiding the DC offset problem the signal that gets integrated by the LMS feedback loop does not contain a term proportional to sgne n . Therefore the LMS feedback loop bandwidth can be relatively large without significantly degrading the PLL s phase noise performance.

The dynamics of the PLL are implied by the common mode half circuit shown in which is equivalent to the core of a conventional phase noise cancelling PLL. To the extent that the two loop filter half circuits and the two varactor halves are matched respectively the current steering operation controlled by sgne n has no affect the common mode half circuit. Although mismatches between the two loop filter halves and between the two varactor halves do cause some degradation of the PLL s phase noise in practice simulation and measurement results indicate that the phase noise resulting from such mismatches is well below that caused by other noise sources in the PLL. Furthermore careful analysis and simulation indicate that even high levels of differential mode to common mode and common mode to differential mode conversion do not cause the PLL or the LMS feedback loop to become unstable.

A block diagram of the experimental IC is shown in . With the exception of 12 MHz reference frequency crystal all blocks shown in the figure are integrated on a single chip as well as a 3 wire digital interface to control the IC a VCO output buffer and a buffer connected between the VCO and the divider.

The IC is implemented in the TSMC 0.18 m single poly six metal CMOS technology with thin top metal metal insulator metal MiM capacitor poly resistor and deep n well process options. All circuitry is operated from a 1.8V supply and electro static discharge ESD protection circuitry is included for all the pads. Separate deep n wells and supply domains are used to help provide isolation.

The divider core consists of seven stages of divide by two pulse swallowing blocks as shown in . The two highest frequency blocks and are implemented with current mode logic CML and the remaining five blocks are implemented with CMOS logic with conversion circuits handling CMOS CML conversion. The output of the divider core is resynchronized to the output of the first CML block to remove jitter from the last six pulse swallowing blocks and to reduce modulus dependent divider delays i.e. differences between the ideal and actual times of the divider s output edges that depend on N y n . The purpose of the two flip flops that are clocked by the outputs of the second and third pulse swallowing blocks respectively is to avoid race conditions in the resynchronization circuitry. In addition to v t the divider generates enable signals for the charge pump dynamic bias and DAC circuits.

The use of fixed width DAC pulses to cancel the quantization noise in fixed amplitude charge pump pulses causes imperfect cancellation while the pulses are active. Most prior published phase noise cancelling fractional N PLLs align the rising edge of each DAC pulse with a rising edge of v t as shown in . To the extent that the DAC and charge pump pulses do not overlap the loop filter is disturbed significantly before the charge delivered by the two pulses cancel each other. For example if the charge pump pulse occurs before the DAC pulse as shown in the entire charge pump pulse is injected into the loop filter before its charge is cancelled by the DAC pulse. This disturbs v t and contributes to the overall PLL phase noise more than would occur if the charge pump and DAC pulses were timed to overlap each other as shown in .

Simulated PSDs of the PLL phase noise caused by the disturbance of v t during the charge pump and DAC pulses for the two cases shown in are shown in respectively. As indicated by the simulation results the timing modification implemented in the invention relative to typical previous designs discussed in the background significantly reduces the phase noise resulting from the inherent mismatch between the amplitude modulated DAC pulses and the width modulated charge pump pulses.

The architecture of the 10 bit current steering DAC is shown in . The DAC consists of a segmented dynamic element matching DEM encoder followed by two banks of 26 weighted return to zero one bit current DACs . The outputs of the one bit current DACs in each bank are connected to one of the two loop filter halves. Alternatively the split architecture is applicable to the charge pump in which case the banks and are separately enabled charge pump banks. During each reference period one or the other of the two banks of one bit current DACs is enabled depending upon the sign of sgne n . This alternate enablement of the DAC banks and or of charge pump banks implements the function of the current steering switch shown in for the current pulses from the 10 bit DAC. In each of the DAC banks there are 16 one bit current DACs with a weight of 32 LSBs and five pairs of one bit current DACs with weights of 1 2 4 8 and 16 LSBs respectively.

As seen in each one bit current DAC consists of two resistively degenerated current sources that are enabled in a manner similar to that of the charge pump. Large devices are used to minimize mismatches. Unfortunately this causes the channel charge contained in M M Mand Mto be large relative to the charge in the current pulse from the one bit DAC. When the current source is switched off this unwanted channel charge is injected into the loop filter . To mitigate this problem transistors Mand Mare used to short the source and gate of Mand of Mat the end of each DAC current pulse. This causes most of the channel charge to be injected into the DAC bias line instead of the loop filter . The resulting disturbance of the DAC bias occurs at the end of the DAC current pulse and the bias voltages have enough time to settle to their correct values prior to the next pulse at which time Mand Mare opened.

The purpose of the DEM encoder is to prevent amplitude and transient errors arising from component mismatches among the one bit current DACs from introducing harmonic distortion. The details of the DEM encoder are shown in . Its architecture and functionality are similar to those of the DEM encoder presented K L Chan and I. Galton A 14b 100 MS s DAC with fully segmented dynamic element matching pp. 390 391 February 2006.

Although e n is an 18 bit digital number as shown in it is requantized to 10 bits to reduce the required precision of the DAC. An 8 bit pseudo random sequence is added to the least significant bits of e n and the result is truncated to 10 bits to ensure that the requantization process does not introduce harmonic distortion.

The average current consumed by a charge pump output stage is very low because the charge pump is only on for a small portion of each reference period. However in most designs the charge pump bias generator is left on. Had this been done on the IC the charge pump would have consumed an average current of just over 10 mA which is more than 50 of the current consumed by all the other circuit blocks in the PLL combined.

Instead current is saved by powering up most of the circuitry in the charge pump bias generator for only of each reference period just before the charge pump output stage is turned on. The dynamic biasing idea was proposed in J. Lee S O Lee. M. Yoh I. Ryu and B H Park. A 13 mW 2 GHz 520 MHz Dual Band Frequency Synthesizer for PCS Applications. vol. 39 no. 1 pp. 8 13 July 2001 without a description of the circuit details. The circuit used to implement dynamic biasing in the preferred experimental IC is shown in . On average the dynamic biasing circuit reduces the average current consumption of the charge pump by almost 8 mA.

The PFD is identical to that described in S. Pamarti L. Jansson. I. Galton. A wideband 2.4 GHz fractional N PLL with 1 Mb s in loop modulation vol. 39 no. 1 pp. 49 62 January 2004. It generates signals U D U and Dwhich control the two charge pump output stages shown in . Together the PFD and charge is pump realize a linearization scheme that reduces errors from mismatches between the positive and negative charge pump currents.

The VCO is a negative gCMOS LC oscillator with a differential spiral inductor stacked in metal layers 5 and 6. As described above it is modified relative to a conventional VCO in that it has two half sized parallel varactors instead of a single varactor. The nominally equal MOS varactors provide tuning over a 0.6V 1.2V range with a nominal Kof 60 MHz V from each input. Coarse digital tuning is provided by switching MIM capacitors of 20 fF and 80 fF into the VCO tank. This allows the VCO to operate over the full 2.4 GHz ISM band See e.g. S. T. Lee S. J. Fang D. J. Allstot A. Bellaouar. A. R. Fridi and P. A. Fontaine A Quad Band GSM GPRS transmitter with digital auto calibration vol. 39 no. 12 pp. 2200 2214 December 2004. Two buffers are AC coupled to the VCO and separately drive the divider and an off chip 50 load.

The fully integrated loop filter consists of two 5 k polysilicon resistors two 18 pF MiM capacitors and two 282 pF pMOS capacitors. Coarse digital tuning is provided to account for process variations. A folded cascode single stage OTA followed by a simple voltage to current converter is used in the LMS feedback loop.

A photograph of the IC die is shown in . The die measures 2.2 mm by 2.2 mm including ESD devices and pads. The IC was tested in a 32 pin QFN package.

The current consumption of the PLL circuitry in the IC is 20.9 mA with the dynamic charge pump bias technique enabled. When the dynamic charge pump bias technique is disabled the total current consumption increases by 8 mA although neither the phase noise or spurious performance change measurably. Therefore all of the measured results described below were obtained with the dynamic charge pump bias technique enabled.

The IC was tested at 1 MHz frequency steps from 2.4 to 2.48 GHz. Table 1 summarizes the worst case performance of the IC over these frequencies with the adaptive phase noise cancellation technique enabled and disabled. The measured loop bandwidth was 730 kHz in all cases. The worst case spot phase noise with the adaptive phase noise cancellation technique enabled is 101 dBc Hz and 124 dBc Hz at 100 kHz and 3 MHz offsets respectively with no significant variation over the tested frequencies. Table 2 summarizes the performance of the PLL compared with relevant prior art.

The output of the calibration loop s OTA optionally can be connected to an output pin through a MOS transistor switch for calibration settling time measurements. A representative waveform from this pin measured as the calibration loop settled is shown in and indicates a settling time of 35 s. Several such measurements were made for different PLL output frequencies. The results show that the settling time does not vary significantly as a function of the PLL s output frequency.

While specific embodiments of the present invention have been shown and described it should be understood that other modifications substitutions and alternatives are apparent to one of ordinary skill in the art. Such modifications substitutions and alternatives can be made without departing from the spirit and scope of the invention which should be determined from the appended claims.

