---

title: Dynamic processing core selection for pre- and post-processing of multimedia workloads
abstract: Apparatus having corresponding methods comprise a processing core performance monitoring module adapted to receive indications of performance levels of a plurality of processing cores, the plurality of processing cores comprising a central processing unit (CPU), a video accelerator, and a graphics accelerator; a video accelerator performance monitoring module adapted to receive an indication of a performance level of the video accelerator; a graphics accelerator performance monitoring module adapted to receive an indication of a performance level of the graphics accelerator; and a processor core management module adapted to dynamically allocate at least one of a pre-processing task and a post-processing task of a multimedia workload to any one of the video accelerator, the graphics accelerator, and the CPUprocessing cores based on the performance levels of the video accelerator, the graphics accelerator, and the CPU.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08610727&OS=08610727&RS=08610727
owner: Marvell International Ltd.
number: 08610727
owner_city: Hamilton
owner_country: BM
publication_date: 20090316
---
This application claims the benefit of U.S. Provisional Patent Application Ser. No. 61 036 657 filed on Mar. 14 2008 the disclosure thereof incorporated by reference herein in its entirety.

The present disclosure relates generally to multimedia processing. More particularly the present disclosure relates to pre processing and post processing of multimedia workloads.

As multimedia becomes more prevalent and pervasive on consumer electronic devices such as smart phones personal digital players portable multimedia players digital picture frames portable navigation devices Internet media player and other such devices the demand for processing and multimedia accelerators increases. Hence in a typical system on a chip SoC there are multiple processing cores for processing multimedia workloads. For example the processing cores can include a central processing unit CPU a video accelerator and a graphics accelerator.

According to conventional approaches pre processing and post processing of multimedia workloads is performed by the CPU regardless of which processing core processes the multimedia workloads.

The inventors have recognized that these pre processing and post processing tasks can be performed by processing cores other than the CPU for example by video accelerators graphics accelerators and the like. One advantage of an allocation of a pre processing or post processing task to a processing core other than the CPU is a reduction in the workload of the CPU. Another advantage lies in the fact that a processing core other than the CPU can generally perform the task with much lower power consumption than the CPU.

In general in one aspect an embodiment features an apparatus comprising a processing core performance monitoring module adapted to receive indications of performance levels of a plurality of processing cores the plurality of processing cores comprising a central processing unit CPU a video accelerator and a graphics accelerator a video accelerator performance monitoring module adapted to receive an indication of a performance level of the video accelerator a graphics accelerator performance monitoring module adapted to receive an indication of a performance level of the graphics accelerator and a processor core management module adapted to dynamically allocate at least one of a pre processing task and a post processing task of a multimedia workload to any one of the video accelerator the graphics accelerator and the CPUprocessing cores based on the performance levels of the video accelerator the graphics accelerator and the CPU.

In general in one aspect an embodiment features a method comprising receiving indications of performance levels of a plurality of processing cores the plurality of processing cores comprising a central processing unit CPU a video accelerator and a graphics accelerator receiving an indication of a performance level of the CPU receiving an indication of a performance level of the video accelerator receiving an indication of a performance level of the graphics accelerator and dynamically allocating at least one of a pre processing task and a post processing task of a multimedia workload to any one of the video accelerator the graphics accelerator and the CPUprocessing cores based on the performance levels of the video accelerator the graphics accelerator and the CPU.

In general in one aspect an embodiment features a computer program executable on a processing core of a computer comprising a plurality of the processing cores the computer program comprising instructions for receiving indications of performance levels of the processing cores and instructions for dynamically allocating at least one of a pre processing task and a post processing task of a multimedia workload to one of the processing cores based on the performance levels. In some embodiments the plurality of processing cores comprises a central processing unit CPU a video accelerator and a graphics accelerator and the computer program further comprises instructions for receiving an indication of a performance level of the CPU instructions for receiving an indication of a performance level of the video accelerator instructions for receiving an indication of a performance level of the graphics accelerator and instructions for dynamically allocating the at least one of the pre processing task and the post processing task of the multimedia workload to one of the video accelerator the graphics accelerator and the CPU based on the performance levels.

The details of one or more implementations are set forth in the accompanying drawings and the description below. Other features will be apparent from the description and drawings and from the claims.

The leading digit s of each reference numeral used in this specification indicates the number of the drawing in which the reference numeral first appears.

Embodiments of the present disclosure provide elements of a method to dynamically detect each multimedia workload and appropriately select processing cores for pre processing and post processing of the multimedia workload. Various embodiments include receiving indications of performance levels of a plurality of processing cores and dynamically allocating the pre processing and or post processing of a multimedia workload to one of the processing cores based on the performance levels. The term dynamically is used to indicate that the allocation occurs during runtime.

Referring to processing device includes a system on a chip SoC . But while various embodiments are described with reference to SoCs the modules of the SoCs can be fabricated as multiple integrated circuits instead. As used herein the term module refers to hardware software or any combination thereof.

SoC includes a plurality of processing cores including a central processing unit CPU a video accelerator and a graphics accelerator . SoC further includes a processing core performance monitoring module adapted to receive indications of the performance levels of processing cores . In particular processing core performance monitoring module includes a CPU performance monitoring module adapted to receive indications of the performance levels of CPU a video accelerator performance monitoring module adapted to receive indications of performance levels of video accelerator and a graphics accelerator performance monitoring module adapted to receive indications of performance levels of graphics accelerator .

SoC further includes a processing core performance reporting module adapted to provide the indications of the performance levels of processing cores . In particular processing core performance reporting module includes a CPU performance reporting module adapted to provide the indications of the performance levels of CPU a video accelerator performance reporting module adapted to provide the indications of performance levels of video accelerator and a graphics accelerator performance reporting module adapted to provide the indications of performance levels of graphics accelerator . Video accelerator performance reporting module and graphics accelerator performance reporting module can be implemented as device drivers capable of providing the desired performance indications.

SoC further includes a multimedia workload monitoring module adapted to detect multimedia workloads and a processor core management module adapted to dynamically allocate pre processing tasks and post processing tasks of the multimedia workloads to one of processing cores based on the performance levels. Each of the tasks can be allocated to any processing core . Similar tasks for different multimedia workloads can be allocated to the same or different processing cores . The pre processing tasks and post processing tasks for a single multimedia workload can be allocated to the same or different processing cores .

Processing device further includes other modules . Other modules can include storage devices such as memories hard drives and the like display devices input devices such as keyboards pointing devices and the like network interface audio input and output devices and so on. Some of the modules can be implemented on SoC if desired.

Referring to processing core performance reporting module provides indications of performance levels of processing cores step . In particular CPU performance reporting module provides indications of the performance levels of CPU video accelerator performance reporting module provides indications of performance levels of video accelerator and graphics accelerator performance reporting module provides indications of performance levels of graphics accelerator .

Processing core performance monitoring module receives the indications of the performance levels of processing cores step . In particular CPU performance monitoring module receives indications of the performance levels of CPU video accelerator performance monitoring module receives indications of performance levels of video accelerator and graphics accelerator performance monitoring module receives indications of performance levels of graphics accelerator .

The performance levels can represent processing performance power consumption and the like and can be selected by configuring one or more profiling parameters. Processing performance can be measured by processor utilization memory utilization operating frequency and the like. Processor utilization can be measured by instructions per second operating system idle threads and the like. Power consumption can be measured by current consumption voltage levels operating temperature and the like. Other indications can be used as well. For example one indication of performance is whether a multimedia workload is processor bound or memory bound that is whether the workload is limited by the processor or memory. Other indications are contemplated. Many of these indications can be reported and monitored dynamically that is at runtime. Other indications can only be reported and monitored statically that is not at runtime. Both kinds of indications can be used by various embodiments.

The indications of performance levels are preferably collected periodically in sampling windows having configurable durations. Preferably the sampling windows are of the same duration and phase for all of the processing cores . The performance levels can include current performance current available performance predicted future performance and the like. Processing performance can be predicted based on expected processor and or memory utilization of expected future tasks. Power consumption can be predicted as well for example as described in copending U.S. patent application Ser. No. 12 400 604 filed Mar. 9 2009 entitled An Adaptive Closed Loop Chip Power Predictor In A Power Management Framework the disclosure thereof incorporated by reference herein in its entirety.

Multimedia workload monitoring module detects multimedia workloads to be processed step . For example the multimedia workloads can include video workloads graphics workloads speech recognition workloads and the like and encoding and decoding for those workloads. When a multimedia workload is detected processor core management module responds by dynamically allocating pre processing tasks of the multimedia workload post processing tasks of the multimedia workload or both to one or more of processing cores based on the reported performance levels step . That is processor core management module dynamically allocates each of the pre processing and or post processing tasks to CPU video accelerator or graphics accelerator based on the performance levels. When CPU has multiple cores processor core management module can dynamically allocate tasks to the cores individually.

The pre processing tasks can include video stabilization noise reduction contrast enhancement temporal filtering and the like. The post processing tasks can include deblocking filtering deringing filtering de interlacing clipping resizing rotating and the like. Processor core management module can base the dynamic allocation of tasks based on additional factors as well for example including the type of multimedia workload.

Processor core management module can dynamically allocate a task by generating a multimedia performance event that causes the context of the task to be mapped to the selected processing core . These events can trigger other changes for example such as changing the speed of the memory bus changing the frequency of one or more of the processing cores and the like.

Processor core management module can employ a look up table to dynamically allocate the tasks. The look up table can be generated according to predetermined policies for example. Several entries from an example look up table are presented in Table 1.

Referring to Table 1 when a graphics workload is detected that is CPU bound where CPU utilization is 40 current video accelerator performance is 10 and current graphics accelerator performance is 80 processor core management module generates a multimedia performance event that maps the context of the pre processing and or post processing of the multimedia workload to graphics accelerator . Referring to the next two entries in Table 1 when a video decoding or encoding workload is detected that is CPU bound where CPU utilization is 40 current video accelerator performance is 80 and current graphics accelerator performance is 0 processor core management module generates a multimedia performance event that maps the context of the pre processing and or post processing of the multimedia workload to video accelerator . Referring to the last entry in Table 1 when a graphics and video workload is detected that is CPU bound and memory bound where CPU utilization is 50 current video accelerator performance is 80 and current graphics accelerator performance is 80 processor core management module generates a multimedia performance event that maps the context of the pre processing and or post processing of the multimedia workload to CPU and increases the speed of the memory bus. Of course these are only a few entries for an example look up table. Many other entries and policies for generating the entries are contemplated.

Referring to an application interfaces with lower level building blocks either through an OpenMAX application layer AL interface or a native GStreamer interface . Video encode decode component video pre processing component and video post processing component are implemented in an OpenMax integration layer IL together with other common components such as a clock component resource components and the like. Below IL layer an OpenMAX development layer DL is provided. Below DL layer are device drivers including video accelerator device driver graphics accelerator device driver and display device driver . Also shown is an embedded system graphics library EGL . In software architecture video pre processing and post processing are usually flexible and can happen in many places in the system.

A processor core management module PCMM is shown as well. Processor core management module can be implemented as processor core management module of and can include the functions of multimedia workload monitoring module processing core performance monitoring module and CPU performance reporting module . The functions of video accelerator performance reporting module can be included in video accelerator device driver while the functions of graphics accelerator performance reporting module can be included in graphics accelerator device driver .

Processor core management module interfaces with OpenMAX IL layer for example to detect multimedia workloads to be processed. Processor core management module also gathers indications of performance from graphics accelerator device driver and video accelerator device driver as well as CPU core s . Based on these performance indications processor core management module generates multimedia performance events to OpenMAX IL layer with maps of the processing context.

To accomplish these tasks processor core management module provides a plurality of application programming interfaces APIs . Some example APIs and their functions are listed in Table 2.

Various embodiments can be implemented in digital electronic circuitry or in computer hardware firmware software or in combinations of them. Embodiments can be implemented in a computer program product tangibly embodied in a machine readable storage device for execution by a programmable processor and method steps can be performed by a programmable processor executing a program of instructions to perform functions by operating on input data and generating output. Embodiments can be implemented in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from and to transmit data and instructions to a data storage system at least one input device and at least one output device. Each computer program can be implemented in a high level procedural or object oriented programming language or in assembly or machine language if desired and in any case the language can be a compiled or interpreted language. Suitable processors include by way of example both general and special purpose microprocessors. Generally a processor will receive instructions and data from a read only memory and or a random access memory. Generally a computer will include one or more mass storage devices for storing data files such devices include magnetic disks such as internal hard disks and removable disks magneto optical disks and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non volatile memory including by way of example semiconductor memory devices such as EPROM EEPROM and flash memory devices magnetic disks such as internal hard disks and removable disks magneto optical disks and CD ROM disks. Any of the foregoing can be supplemented by or incorporated in ASICs application specific integrated circuits .

A number of implementations have been described. Nevertheless it will be understood that various modifications may be made without departing from the scope of the disclosure. For example implementations can provide 3D graphics and video effects for maps and locations displayed by portable navigation devices and the like. Accordingly other implementations are within the scope of the following claims.

